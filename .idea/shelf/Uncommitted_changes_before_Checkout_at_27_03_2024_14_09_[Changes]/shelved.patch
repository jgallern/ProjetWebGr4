Index: Pages_Gestions/gestion_entreprise_pilote_admin.php
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?php\r\nrequire_once \"header1.php\"; \r\nglobal $bdd;\r\n\r\n$entreprise = new Entreprise();\r\n$entreprise->set_bddconnection($bdd);\r\n\r\n// Initial definitions\r\n$entreprises = [];\r\n$secteurs = [];\r\n\r\n// Handling form submissions for creating enterprises and adding new sectors\r\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\r\n    // Handling 'Other' sector submissions\r\n    if (isset($_POST['secteur']) && $_POST['secteur'] === 'Autre' && !empty($_POST['autre_secteur'])) {\r\n        $Nouveau_secteur = $_POST['autre_secteur'];\r\n\r\n        // Insert new sector into database\r\n        $stmt = $bdd->prepare(\"INSERT INTO secteuractivite (nom_secteur) VALUES (?)\");\r\n        $stmt->execute([$Nouveau_secteur]);\r\n        $secteur = $bdd->lastInsertId(); // Update $secteur to use the newly inserted sector's ID\r\n    }\r\n\r\n    // Handling submissions from the create enterprise form\r\n    if (isset($_POST['nom'])) {\r\n        $nom = $_POST['nom'];\r\n        $description = $_POST['description'];\r\n        $numeroRue = $_POST['numero_rue'];\r\n        $nomRue = $_POST['nom_rue'];\r\n        $ville = $_POST['ville'];\r\n        $logoPath = ''; // Initialize the variable to avoid errors\r\n\r\n        // Handle logo upload logic here\r\n        // Ensure $logoPath is correctly set upon successful upload or remains empty\r\n\r\n        // Create enterprise with provided information\r\n        if ($logoPath !== '') {\r\n            $entreprise->Creer_Entreprise($nom, $description, $secteur, $logoPath, $numeroRue, $nomRue, $ville);\r\n        }\r\n    }\r\n\r\n    // Handling search form submissions\r\n    if (isset($_POST['submit-search'])) {\r\n        $searchName = isset($_POST['search_name']) ? $_POST['search_name'] : null;\r\n        $searchVille = isset($_POST['search_ville']) ? $_POST['search_ville'] : '';\r\n        $searchNumeroRue = isset($_POST['search_numero-rue']) ? $_POST['search_numero-rue'] : '';\r\n        $searchNomRue = isset($_POST['search_nom-rue']) ? $_POST['search_nom-rue'] : '';\r\n        $searchSector = isset($_POST['search_sector']) ? $_POST['search_sector'] : null;\r\n\r\n        $entreprises = $entreprise->Rechercher_Entreprise($searchName, $searchSector, $searchVille,$searchNumeroRue,$searchNomRue);\r\n        if (empty($entreprises)) {\r\n            $noResultsMessage = \"Aucun résultat trouvé pour les critères de recherche spécifiés.\";\r\n        }\r\n    } else {\r\n        // Fetch random or initial set of enterprises\r\n        $entreprises = $entreprise->FetchRandomEntreprises(); // Ensure you have this method in your class\r\n        if (empty($entreprises)) {\r\n            $noResultsMessage = \"Aucune entreprise disponible pour l'affichage.\";\r\n        }\r\n    }\r\n}\r\n// Fetching sectors for the sector selection dropdown\r\ntry {\r\n    $stmt = $bdd->query(\"SELECT ID_secteur, nom_secteur FROM secteuractivite\");\r\n    $secteurs = $stmt->fetchAll(PDO::FETCH_ASSOC);\r\n} catch (PDOException $e) {\r\n    echo \"Erreur lors de la récupération des secteurs : \" . $e->getMessage();\r\n    exit;\r\n}\r\n\r\n// Continue with HTML content below\r\n?>\r\n\r\n<!doctype html>\r\n<html lang=\"fr\">\r\n\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <title>Gestion entreprise\r\n    </title>\r\n    <link rel=\"stylesheet\" href=\"style.css\">\r\n    <script src=\"script.js\"></script>\r\n    <link rel=\"icon\" href=\"\" type=\"image/png\">\r\n\r\n<body>\r\n    <nav id=\"navbar\">\r\n        <img id=\"logo_seb\" src=\"./logo_png.png\" alt=\"logo\" width=\"150px\" />\r\n        <div id=\"lien_navbar\">\r\n            <a class=\"lien_nav police_texte\" href=\"gestion_entreprise_pilote_admin.html\" id=\"lien_entreprises_etudiants\">Entreprises</a>\r\n            <a class=\"lien_nav police_texte\" href=\"gestion_offres_pilote_admin.html\" id=\"lien_offres_etudiants\">Offres</a>\r\n            <a class=\"lien_nav police_texte\" href=\"gestion_entreprise_pilote_admin.html\" id=\"lien_offres_etudiants\">Pilotes</a>\r\n            <a class=\"lien_nav police_texte\" href=\"gestion_entreprise_pilote_admin.html\" id=\"lien_offres_etudiants\">Etudiants</a>\r\n            <a class=\"lien_nav police_texte\" href=\"page_wishlist_candidatures.html\" id=\"lien_wishlist\">Mes listes</a>\r\n            <a class=\"lien_nav police_texte\" href=\"page_wishlist_candidatures.html\" id=\"lien_candidatures\">Candidatures</a>\r\n        </div>\r\n        <div id=\"profil\">\r\n            <div id=\"detail_profil\" class=\"police_texte\">\r\n                <h3 id=\"nom_prenom_etudiant\">Quentin Baud</h3>\r\n                <button id=\"bouton_voir_profil\">Voir le profil</button>\r\n                <button id=\"bouton_deconnexion\">Se déconnecter</button>\r\n            </div>\r\n\r\n            <img id=\"photo_profil\"\r\n                src=\"C:\\Users\\quent\\OneDrive - Association Cesi Viacesi mail\\A2\\04_web\\Projet\\images\\photo_profil.png\"\r\n                alt=\"photo_profil\">\r\n        </div>\r\n\r\n    </nav>\r\n\r\n    <main>\r\n        <h1 class=\"titre police_texte\">Gestion des Entreprises</h1>\r\n\r\n        <section class=\"bloc_gestion police_texte\">\r\n            <h2>Rechercher une entreprise</h2>\r\n            <div id=\"recherche_container\">\r\n\r\n                <div id=\"form_recherche\">\r\n                    <form id=\"searchForm\" method=\"POST\" action=\"\" enctype=\"multipart/form-data\">\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-name\">Nom de l'entreprise :</label><br>\r\n                            <input id=\"search-name\" name=\"search_name\" type=\"text\" placeholder=\"Entrez le nom de l'entreprise\" />\r\n                        </div>\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-stages\">Nombre d'offres de stage :</label><br>\r\n                            <input id=\"search-stages\" name=\"search_stages\" type=\"number\" placeholder=\"Entrez le nombre d'offres\" />\r\n                        </div>\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-ville\">Ville d'entreprise :</label><br>\r\n                            <input id=\"search-ville\" name=\"search_ville\" type=\"text\" placeholder=\"Entrez le lieu\" />\r\n                        </div>\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-numero-rue\">Numero-Rue d'entreprise :</label><br>\r\n                            <input id=\"search-numero-rue\" name=\"search_numero-rue\" type=\"text\" placeholder=\"Entrez le lieu\" />\r\n                        </div>\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-nom-rue\">Nom-Rue d'entreprise :</label><br>\r\n                            <input id=\"search-nom-rue\" name=\"search_nom-rue\" type=\"text\" placeholder=\"Entrez le lieu\" />\r\n                        </div>\r\n                        <div class=\"form-row\">\r\n                            <label for=\"search-sector\">Secteur d'activité :</label><br>\r\n                            <select id=\"create-sector\" name=\"secteur\" onchange=\"showOtherSectorInput(this.value);\">\r\n                                <option value=\"\">--Choisir--</option>\r\n                                <?php foreach ($secteurs as $secteur): ?>\r\n                                    <option value=\"<?= htmlspecialchars($secteur['ID_secteur']) ?>\"><?= htmlspecialchars($secteur['nom_secteur']) ?></option>\r\n                                <?php endforeach; ?>\r\n                                <option value=\"Autre\">Autre</option>\r\n                            </select>\r\n                            <input type=\"text\" id=\"autre-secteur\" name=\"autre_secteur\" placeholder=\"Entrez le nouveau secteur\" style=\"display: none;\">\r\n                        </div>\r\n                        <div class=\"form_buttons\">\r\n                            <button type=\"submit\" name=\"submit-search\" class=\"button-search\">Rechercher</button>\r\n                            <button type=\"reset\" class=\"button-reset\">Réinitialiser</button>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n                <div id=\"fiches_entreprises_et_boutons\">\r\n                    <div id=\"result_recherche_entreprise\">\r\n                        <?php\r\n                        // Display no results message if set\r\n                        if (isset($noResultsMessage)) {\r\n                            echo '<div class=\"no-results-message\">' . htmlspecialchars($noResultsMessage) . '</div>';\r\n                        } else {\r\n                            // Iterate over $entreprises to display them, since there's no \"no results\" message set\r\n                            foreach ($entreprises as $entreprise) {\r\n                                ?>\r\n                                <div class=\"recherche_fiche_entreprise\">\r\n                                    <img width=\"80px\" src=\"path/to/logo/<?php echo htmlspecialchars($entreprise['logo']); ?>\" alt=\"img entreprise\">\r\n                                    <h3><?php echo htmlspecialchars($entreprise['nom']); ?></h3>\r\n                                    <p><?php echo htmlspecialchars($entreprise['description']); ?></p>\r\n                                    <!-- Additional details here -->\r\n                                </div>\r\n                                <?php\r\n                            }\r\n                        }\r\n                        ?>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n\r\n                <div id=\"overlay\"></div>\r\n                        <div id=\"message\">Veuillez sélectionner une entreprise</div>\r\n                    </div>\r\n\r\n\r\n                    <div id=\"icones_modif\">\r\n                        <div class=\"image-container\" id=\"btn_modif\">\r\n                            <img \r\n                                src=\"C:/Users/quent/OneDrive - Association Cesi Viacesi mail/A2/04_web/Projet/images/ico_modifier.png\"\r\n                                width=\"30px\">\r\n                            <div class=\"overlay\"></div>\r\n                        </div>\r\n                        <div class=\"image-container\" id=\"btn_stats\">\r\n                            <img\r\n                                src=\"C:/Users/quent/OneDrive - Association Cesi Viacesi mail/A2/04_web/Projet/images/ico_stats.png\"\r\n                                width=\"30px\">\r\n                            <div class=\"overlay\"></div>\r\n                        </div>\r\n                        <div class=\"image-container\" id=\"btn_voir\">\r\n                            <img\r\n                                src=\"C:/Users/quent/OneDrive - Association Cesi Viacesi mail/A2/04_web/Projet/images/ico_oeil.png\"\r\n                                width=\"30px\">\r\n                            <div class=\"overlay\"></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n\r\n        </section>\r\n\r\n        <div id=\"overlay_suppression\"></div>\r\n\r\n        <div id=\"confirmationSuppression\" class=\"police_texte\">\r\n            <p>Voulez-vous vraiment supprimer l'entreprise ?</p>\r\n            <button id=\"btnOui\">Oui</button>\r\n            <button id=\"btnNon\">Non</button>\r\n        </div>\r\n\r\n        <section id=\"result_all\">\r\n            <fieldset id=\"result_modif\" class=\"police_texte\">\r\n                <legend>Modifer une entreprise</legend>\r\n                <form>\r\n                    <div id=\"deux_partie_modif\">\r\n                        <div id=\"partie_modif\">\r\n                            <label>Nouveau nom :</label><br>\r\n                            <input type=\"text\" id=\"nouv_nom\" name=\"nouv_nom\" placeholder=\"Nouveau nom\">\r\n                            <br>\r\n                            <label>Nouveau secteur :</label><br>\r\n                            <select name=\"nouv_secteur\">\r\n                                <option>--Choisir--</option>\r\n                                <option>Informatique</option>\r\n                                <option>BTP</option>\r\n                                <option>S3E</option>\r\n                                <option>jesaisplu</option>\r\n                            </select>\r\n                            <br>\r\n                            <label>Nouvelle localité :</label><br>\r\n                            <div id=\"adresses\">\r\n                                <!-- Conteneur pour les adresses -->\r\n                            </div>\r\n                            <button type=\"button\" id=\"ajouterAdresse\">Ajouter une adresse</button>\r\n\r\n                            <br>\r\n                            <label>Nouvelle image :</label><br>\r\n                            <input name=\"image_entreprise\" type=\"file\" accept=\"image/jpeg, image/png\">\r\n                        </div>\r\n                        <div id=\"partie_eval\">\r\n                            <label>Evaluer l'entreprise :</label>\r\n                            <div class=\"rating\" id=\"rating\">\r\n                                <span class=\"star\" data-value=\"1\">&#9733;</span>\r\n                                <span class=\"star\" data-value=\"2\">&#9733;</span>\r\n                                <span class=\"star\" data-value=\"3\">&#9733;</span>\r\n                                <span class=\"star\" data-value=\"4\">&#9733;</span>\r\n                                <span class=\"star\" data-value=\"5\">&#9733;</span>\r\n                            </div>\r\n                            <label>Commentaire :</label><br>\r\n                            <textarea class=\"police_texte\" id=\"commentaire_entreprise\" name=\"commentaire_entreprise\"\r\n                                placeholder=\"Entrez un commentaire\"></textarea>\r\n                            <br>\r\n                            <button id=\"supprimer_entreprise\">Supprimer l'entreprise</button> <br>\r\n                            <div id=\"btn_envoi\">\r\n                                <button type=\"reset\">Réinitialiser</button>\r\n                                <button type=\"submit\">Modifer</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                </form>\r\n            </fieldset>\r\n\r\n\r\n            <fieldset id=\"result_stats\" class=\"police_texte\">\r\n                <legend>Statistiques de l'entreprise</legend>\r\n                <p><strong>Nom de l'entreprise :</strong> GOGO Corporation</p>\r\n                <p><strong>Le top des offres :</strong></p>\r\n                <p><strong>Nombre d'étudiants actuellement en stage :</strong< /p>\r\n                        <div class=\"rating\">\r\n                            <span><strong>Moyenne de l'entreprise :</strong></span>\r\n                            <div class=\"stars\">★★★☆☆</div>\r\n                        </div>\r\n            </fieldset>\r\n\r\n        </section>\r\n\r\n        <section class=\"bloc_gestion police_texte\">\r\n            <h2>Créer une entreprise</h2>\r\n            <form action=\"\" method=\"POST\" enctype=\"multipart/form-data\">\r\n                <div class=\"form-row\">\r\n                    <label for=\"create-name\">Nom de l'entreprise :</label><br>\r\n                    <input id=\"create-name\" name=\"nom\" type=\"text\" placeholder=\"Entrez le nom de l'entreprise\" required />\r\n                </div>\r\n                <div class=\"form-row\">\r\n                    <label for=\"description_entreprise\">Description de l'entreprise</label><br>\r\n                    <textarea class=\"police_texte\" id=\"description_entreprise\" name=\"description\" placeholder=\"Décrivez l'entreprise ici\" required></textarea>\r\n                </div>\r\n                <div class=\"form-row\">\r\n                    <label for=\"create-location\"> Numéro Rue :</label><br>\r\n                    <input id=\"create-location\" name=\"numero_rue\" type=\"text\" placeholder=\"Entrez le numeéro de la rue\" required />\r\n                </div>\r\n                <div class=\"form-row\">\r\n                    <label for=\"create-location\">Rue :</label><br>\r\n                    <input id=\"create-location\" name=\"nom_rue\" type=\"text\" placeholder=\"Entrez la Rue\" required />\r\n                </div>\r\n                <div class=\"form-row\">\r\n                    <label for=\"create-location\">Ville :</label><br>\r\n                    <input id=\"create-location\" name=\"ville\" type=\"text\" placeholder=\"Entrez la ville\" required />\r\n                </div>\r\n\r\n                <div class=\"form-row\">\r\n                    <label for=\"create-sector\">Secteur d'activité :</label><br>\r\n                    <select id=\"create-sector\" name=\"secteur\" required onchange=\"showOtherSectorInput(this.value);\">\r\n                        <option value=\"\">--Choisir--</option>\r\n                        <?php foreach ($secteurs as $secteur): ?>\r\n                            <option value=\"<?= htmlspecialchars($secteur['ID_secteur']) ?>\"><?= htmlspecialchars($secteur['nom_secteur']) ?></option>\r\n                        <?php endforeach; ?>\r\n                        <option value=\"Autre\">Autre</option>\r\n                    </select>\r\n                    <input type=\"text\" id=\"autre-secteur\" name=\"autre_secteur\" placeholder=\"Entrez le nouveau secteur\" style=\"display: none;\">\r\n\r\n                </div>\r\n                <div class=\"form-row\">\r\n                    <label for=\"image_entreprise\">Image de l'entreprise :</label><br>\r\n                    <input id=\"image_entreprise\" name=\"logo\" type=\"file\" accept=\"image/jpeg, image/png\" required>\r\n                    <br>\r\n                    <?php\r\n                    // Handle the logo file upload\r\n                    if (isset($_FILES['logo']) && $_FILES['logo']['error'] == 0) {\r\n                        // Define allowed MIME types for images\r\n                        $allowedMimeTypes = ['image/jpeg', 'image/png', 'image/gif'];\r\n\r\n                        // Get MIME type of the uploaded file\r\n                        $fileMimeType = mime_content_type($_FILES['logo']['tmp_name']);\r\n\r\n                        // Check if the uploaded file is an allowed image type\r\n                        if (in_array($fileMimeType, $allowedMimeTypes)) {\r\n                            $targetDirectory = \"uploads//\"; // Adjust based on your actual uploads directory\r\n                            $logoPath = $targetDirectory . basename($_FILES['logo']['name']);\r\n\r\n                            // Attempt to move the uploaded file to the target directory\r\n                            if (move_uploaded_file($_FILES['logo']['tmp_name'], $logoPath)) {\r\n                                // Success message or further processing\r\n                                echo \"Le logo a été téléchargé avec succès.\";\r\n                            } else {\r\n                                // Reset $logoPath if the upload fails\r\n                                $logoPath = '';\r\n                                echo \"Erreur lors de l'upload du logo.\";\r\n                            }\r\n                        } else {\r\n                            echo \"Le fichier téléchargé n'est pas une image valide. Seuls les formats JPEG, PNG et GIF sont autorisés.\";\r\n                        }\r\n                    } else {\r\n                        // Handle other errors or no file being uploaded\r\n                        if (!isset($_FILES['logo'])) {\r\n                            echo \"Aucun fichier n'a été téléchargé.\";\r\n                        } else {\r\n                            // Output error for debugging\r\n                            echo \"Erreur lors du téléchargement: \" . $_FILES['logo']['error'];\r\n                        }\r\n                    }\r\n                    ?>\r\n                </div>\r\n                <div class=\"form-actions\">\r\n                    <button type=\"submit\" class=\"button-search\">Créer</button>\r\n                    <button type=\"reset\" class=\"button-reset\">Réinitialiser</button>\r\n                </div>\r\n            </form>\r\n        </section>\r\n\r\n\r\n\r\n\r\n        <footer class=\"police_texte\">&copy; Stage En Bref. <br> Tous droits réservés</footer>\r\n</body>\r\n\r\n</html>\r\n\r\n\r\n
===================================================================
diff --git a/Pages_Gestions/gestion_entreprise_pilote_admin.php b/Pages_Gestions/gestion_entreprise_pilote_admin.php
--- a/Pages_Gestions/gestion_entreprise_pilote_admin.php	
+++ b/Pages_Gestions/gestion_entreprise_pilote_admin.php	
@@ -1,5 +1,5 @@
 <?php
-require_once "header1.php"; 
+require_once "header1.php";
 global $bdd;
 
 $entreprise = new Entreprise();
